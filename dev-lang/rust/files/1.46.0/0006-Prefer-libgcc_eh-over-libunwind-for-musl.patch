From 6283153aa9f221fe30d800784c2e1f4f32a5e9cf Mon Sep 17 00:00:00 2001
From: Samuel Holland <samuel@sholland.org>
Date: Sat, 9 Sep 2017 00:14:16 -0500
Subject: [PATCH 06/14] Prefer libgcc_eh over libunwind for musl

---
 src/libunwind/build.rs | 1 -
 src/libunwind/lib.rs   | 2 +-
 2 files changed, 1 insertion(+), 2 deletions(-)

diff --git a/src/libunwind/build.rs b/src/libunwind/build.rs
index 31d235cf679..20bf942fa0f 100644
--- a/src/libunwind/build.rs
+++ b/src/libunwind/build.rs
@@ -14,7 +14,6 @@ fn main() {
     } else if target.contains("linux") {
         if target.contains("musl") {
             // linking for musl is handled in lib.rs
-            llvm_libunwind::compile();
         } else if !target.contains("android") {
             println!("cargo:rustc-link-lib=gcc_s");
         }
diff --git a/src/libunwind/lib.rs b/src/libunwind/lib.rs
index cc025da1af5..4c69b426f23 100644
--- a/src/libunwind/lib.rs
+++ b/src/libunwind/lib.rs
@@ -19,7 +19,7 @@ cfg_if::cfg_if! {
 }
 
 #[cfg(target_env = "musl")]
-#[link(name = "unwind", kind = "static", cfg(target_feature = "crt-static"))]
+#[link(name = "gcc_eh", kind = "static-nobundle", cfg(target_feature = "crt-static"))]
 #[link(name = "gcc_s", cfg(not(target_feature = "crt-static")))]
 extern "C" {}
 
-- 
2.26.2

